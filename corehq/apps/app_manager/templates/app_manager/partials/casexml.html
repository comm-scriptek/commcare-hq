<div id="casexml-template" style="display:none;">
    [% if(edit) { %]
        <div id="condition-template" class="condition">
            <input type="checkbox" name="if" /> If
            <span>
                 the answer to
                <select class="questions questions-select1" name="condition-question">
                    <option value="" disabled="" selected="">Select a question</option>
                </select>
                is
                <select name="condition-answer">
                    <option value="" disabled="" selected="">Select an answer</option>
                </select>
            </span>
        </div>
        <h4>Cases and Referrals</h4>
        [% if(questions) { %]
            <div class="casexml [% if(!edit) {%] no-edit [% } %] config">
                <ul>
                    <li>
                        <form action="[%= save_requires_url %]" method="post">
                            Requires
                            <select class="autosave" name="requires" data-value="[%= requires %]">
                                <option value="none">neither a case nor a referral</option>
                                <option value="case">just a case</option>
                                <option value="referral">a case and a referral</option>
                            </select>
                            <input type="hidden" name="ajax" value="false" />
                        </form>
                    </li>
                </ul>
                <ul>
                    [% if(requires == "none") { %]
                        <li class="action">
                            <input type="checkbox" id="open-case"><label for="open-case">Opens a case</label>
                            <div class="config">
                                <div class="condition"></div>
                                <span>
                                    Name according to question
                                    <select class="questions questions-all" name="name_path">
                                        <option disabled="">Select a question</option>
                                    </select>
                                </span>
                            </div>
                        </li>
                    [% } %]
                    <li class="action">
                        <input type="checkbox" id="update-case"><label for="update-case">Updates the case</label>
                        <div id="update-case-config">
                            <table class="config">
                                <tr>
                                    <th></th>
                                    <th>Question</th>
                                    <th>Case Property</th>
                                </tr>
                                <tr id="action-update-template" class="action-update">
                                    <td></td>
                                    <td>
                                        <select class="questions questions-all" name="action-update-value">
                                            <option></option>
                                        </select>
                                    </td>
                                    <td><input class="code" type="text" name="action-update-key" /></td>
                                </tr>

                            </table>
                        </div>
                    </li>
                    [% if(requires != "none") { %]
                        <li class="action">
                            <input type="checkbox" id="close-case"><label for="close-case">Closes the case</label>
                            <div class="config">
                                <div class="condition"></div>
                            </div>
                        </li>
                    [% } %]
                    [% if(requires != "referral") { %]
                        <li class="action">
                            <input type="checkbox" id="open-referral"> <label for="open-referral">Opens a referral</label>
                            <div class="config">
                                <span>
                                    Name according to question
                                    <select class="questions questions-select questions-select1" name="name_path">
                                        <option disabled="">Select a question</option>
                                    </select>
                                </span>
                            </div>
                        </li>
                    [% } %]
                    [% if(requires == "referral") { %]
                        <li class="action">
                            <input type="checkbox" id="update-referral"> <label for="update-referral">Updates the referral</label>
                            <div class="config">
                                <span>
                                    Change followup date to
                                    <select class="questions questions-input" name="followup_date">
                                        <option disabled="">Select a question</option>
                                    </select>
                                </span>
                            </div>
                        </li>
                        <li class="action">
                            <input type="checkbox" id="close-referral"> <label for="close-referral">Closes the referral</label>
                            <div class="config">
                                <div class="condition"></div>
                            </div>
                        </li>
                    [% } %]
                    <li class="hidden" id="no_casexml_actions">This form does not perform any actions.</li>
                </ul>
                <form action="[%= save_url %]" method="POST">
                    <textarea id="casexml_json" class="hidden" name="actions" >[%= JSON.stringify(actions) %]</textarea><br/>
                    <input type="submit" value="Save Actions"/>
                </form>
            </div>
        [% } else { %]
            <p class="warning">
                I'm unable to get a list of questions from your form. This may mean that your form is corrupted or
                malformed.
            </p>
        [% } %]
    [% } else { %]
        <div class="casexml no-edit config">
            <ul>
                <li>
                    Requires
                    [% if(requires == "none") { %]neither a case nor a referral
                    [% } else if(requires == "case") { %]just a case
                    [% } else if(requires == "referral") { %]a case and a referral
                    [% } %]
                </li>
            </ul>
            <ul>
                [% if(requires == "none") if(action_is_active(actions.open_case)) { %]
                    <li class="action">
                        Opens a case
                        <div class="config">
                            <div class="condition"></div>
                            <span>
                                Name according to question
                                <select class="questions questions-all" name="name_path">
                                    <option disabled="">Select a question</option>
                                </select>
                            </span>
                        </div>
                    </li>
                [% } %]
                <li class="action">
                    <input type="checkbox" id="update-case"><label for="update-case">Updates the case</label>
                    <div id="update-case-config">
                        <table class="config">
                            <tr>
                                <th></th>
                                <th>Question</th>
                                <th>Case Property</th>
                            </tr>
                            <tr id="action-update-template" class="action-update">
                                <td></td>
                                <td>
                                    <select class="questions questions-all" name="action-update-value">
                                        <option></option>
                                    </select>
                                </td>
                                <td><input class="code" type="text" name="action-update-key" /></td>
                            </tr>

                        </table>
                    </div>
                </li>
                [% if(requires != "none") { %]
                    <li class="action">
                        <input type="checkbox" id="close-case"><label for="close-case">Closes the case</label>
                        <div class="config">
                            <div class="condition"></div>
                        </div>
                    </li>
                [% } %]
                [% if(requires != "referral") { %]
                    <li class="action">
                        <input type="checkbox" id="open-referral"> <label for="open-referral">Opens a referral</label>
                        <div class="config">
                            <span>
                                Name according to question
                                <select class="questions questions-select questions-select1" name="name_path">
                                    <option disabled="">Select a question</option>
                                </select>
                            </span>
                        </div>
                    </li>
                [% } %]
                [% if(requires == "referral") { %]
                    <li class="action">
                        <input type="checkbox" id="update-referral"> <label for="update-referral">Updates the referral</label>
                        <div class="config">
                            <span>
                                Change followup date to
                                <select class="questions questions-input" name="followup_date">
                                    <option disabled="">Select a question</option>
                                </select>
                            </span>
                        </div>
                    </li>
                    <li class="action">
                        <input type="checkbox" id="close-referral"> <label for="close-referral">Closes the referral</label>
                        <div class="config">
                            <div class="condition"></div>
                        </div>
                    </li>
                [% } %]
                <li class="hidden" id="no_casexml_actions">This form does not perform any actions.</li>
            </ul>
            <form action="[%= save_url %]" method="POST">
                <textarea id="casexml_json" class="hidden" name="actions" >[%= JSON.stringify(actions) %]</textarea><br/>
                <input type="submit" value="Save Actions"/>
            </form>
        </div>
    [% } %]
</div>